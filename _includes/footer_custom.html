{%- comment -%}
  Gather all pages in the current section, ordered as in the sidebar (parent, then children).
{%- endcomment -%}

{%- assign all_pages = site.html_pages
  | where: "section", page.section
  | where_exp: "item", "item.title != nil"
  | where_exp: "item", "item.nav_order != nil" -%}

{%- assign root_page = all_pages
  | where_exp: "item", "item.parent == nil"
  | sort: "nav_order"
  | first -%}

{%- assign nav_groups = all_pages
  | where_exp: "item", "item.parent == root_page.title"
  | sort: "nav_order" -%}

{%- assign all_pages_nav_order = "" | split: "" -%}
{%- assign all_pages_nav_order = all_pages_nav_order | push: root_page %}
{%- for group in nav_groups -%}
  {%- assign page_children = all_pages
    | where: "parent", group.title
    | sort: "nav_order" %}
  {%- assign all_pages_nav_order = all_pages_nav_order | push: group %}
  {%- assign all_pages_nav_order = all_pages_nav_order | concat: page_children %}
{%- endfor -%}

{% if page.url == "/" %}
  {%- comment -%} Skip the "next page" link if it's the homepage. {%- endcomment -%}
{% else %}
  {%- assign previous_item = nil -%}
  {%- for item in all_pages_nav_order -%}
    {% if previous_item != nil and previous_item.url == page.url %}
      {% assign next_page = item %}
      <a href="{{ next_page.url | relative_url }}" class="next-page">
        <header class="text-delta">Prochaine page</header>
        <div class="fw-500 fs-4">{{ next_page.title }}</div>
        <span role="presentation">â†’</span>
      </a>
    {% endif %}
    {% assign previous_item = item %}
  {%- endfor -%}
{% endif %}